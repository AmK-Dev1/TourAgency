<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="author" content="Untree.co">
      <link rel="shortcut icon" href="favicon.png">
    
      <meta name="description" content="" />
      <meta name="keywords" content="bootstrap, bootstrap4" />
    
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Serif+Pro:wght@400;700&display=swap" rel="stylesheet">
    
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <link rel="stylesheet" href="css/owl.carousel.min.css">
      <link rel="stylesheet" href="css/owl.theme.default.min.css">
      <link rel="stylesheet" href="css/jquery.fancybox.min.css">
      <link rel="stylesheet" href="fonts/icomoon/style.css">
      <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">
      <link rel="stylesheet" href="css/daterangepicker.css">
      <link rel="stylesheet" href="css/aos.css">
      <link rel="stylesheet" href="css/style.css">
    
      <title>Home - Tour Agency</title>
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
<body>
  <nav class="site-nav">
    <div class="container">
      <div class="site-navigation">
        <a href="index.html" class="logo">Tour <span class="text-primary">.</span></a>
        <ul class="site-menu float-right">
          <li><a href="index.html">Home</a></li>
          <li><a href="destinations.html">Destinations</a></li>
          <li><a href="hotels.html">Hotels</a></li>
          <li class="active"><a href="flights.html">Flights</a></li>
          <li><a href="Activities.html">Activities</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-5">
    <h1 class="text-center mb-4">Review and Confirm Your Booking</h1>

    <div id="selectionSummary" class="mb-5"></div>

    <form id="finalBookingForm">
      <div class="form-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" class="form-control" required>
      </div>

      <div class="form-group mt-3">
        <label for="email">Email</label>
        <input type="email" id="email" class="form-control" required>
      </div>

      <button type="submit" class="btn btn-success mt-4">Confirm Booking</button>
    </form>
  </div>


  <div class="py-5 cta-section">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-12">
                <h2 class="mb-2 text-white">Lets you Explore the Best. Contact Us Now</h2>
                <p class="mb-4 lead text-white text-white-opacity">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Excepturi, fugit?</p>
                <p class="mb-0"><a href="booking.html" class="btn btn-outline-white text-white btn-md font-weight-bold">Get in touch</a></p>
            </div>
        </div>
    </div>
</div>

<div class="site-footer">
    <div class="inner first">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-4">
                    <div class="widget">
                        <h3 class="heading">About Tour</h3>
                        <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts.</p>
                    </div>
                    <div class="widget">
                        <ul class="list-unstyled social">
                            <li><a href="#"><span class="icon-twitter"></span></a></li>
                            <li><a href="#"><span class="icon-instagram"></span></a></li>
                            <li><a href="#"><span class="icon-facebook"></span></a></li>
                            <li><a href="#"><span class="icon-linkedin"></span></a></li>
                            <li><a href="#"><span class="icon-dribbble"></span></a></li>
                            <li><a href="#"><span class="icon-pinterest"></span></a></li>
                            <li><a href="#"><span class="icon-apple"></span></a></li>
                            <li><a href="#"><span class="icon-google"></span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6 col-lg-2 pl-lg-5">
                    <div class="widget">
                        <h3 class="heading">Pages</h3>
                        <ul class="links list-unstyled">
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">About</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6 col-lg-2">
                    <div class="widget">
                        <h3 class="heading">Resources</h3>
                        <ul class="links list-unstyled">
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">About</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="widget">
                        <h3 class="heading">Contact</h3>
                        <ul class="list-unstyled quick-info links">
                            <li class="email"><a href="#">mail@example.com</a></li>
                            <li class="phone"><a href="#">+1 222 212 3819</a></li>
                            <li class="address"><a href="#">43 Raymouth Rd. Baltemoer, London 3910</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div class="inner dark">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-8 mb-3 mb-md-0 mx-auto">
                    <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with love by <a href="https://untree.co" class="link-highlight">Untree.co</a> <!-- License information: https://untree.co/license/ -->Distributed By <a href="https://themewagon.com" target="_blank" >ThemeWagon</a>
                    </p>
                </div>
                
            </div>
        </div>
    </div>
</div>

<div id="overlayer"></div>
<div class="loader">
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.animateNumber.min.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/jquery.fancybox.min.js"></script>
<script src="js/aos.js"></script>
<script src="js/moment.min.js"></script>
<script src="js/daterangepicker.js"></script>

<script src="js/typed.js"></script>

<!-- Script here -->
<script>
    $(document).ready(function () {
  const selections = JSON.parse(localStorage.getItem('bookingSelections'));
  if (!selections) {
    $('#selectionSummary').html('<div class="alert alert-warning">No booking data found. Please go back and make a selection.</div>');
    $('#overlayer').fadeOut();
    $('.loader').fadeOut();
    return;
  }

  const { hotelId, flightId, activityIds } = selections;

  const hotelBlock = $('<div id="hotel-summary"></div>');
  const flightBlock = $('<div id="flight-summary"></div>');
  const activityBlock = $('<div id="activities-summary"></div>');

  $('#selectionSummary').append(hotelBlock, flightBlock, activityBlock);

  if (hotelId) {
    $.get(`http://localhost:5002/api/hotels/${hotelId}`, function (hotel) {
        hotelBlock.html(`
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <img src="${hotel.imageUrl}" class="card-img-top" alt="${hotel.name}" style="height: 200px; object-fit: cover;">
        <div class="card-body">
          <h5 class="card-title">Selected Hotel</h5>
          <p><strong>${hotel.name}</strong> in ${hotel.location}</p>
          <p>Price: $${hotel.price.toFixed(2)} per night</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h5 class="mb-3">Hotel Booking Info</h5>
      <div class="form-group">
        <label for="hotelCheckIn">Check-in</label>
        <input type="date" id="hotelCheckIn" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="hotelCheckOut">Check-out</label>
        <input type="date" id="hotelCheckOut" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="hotelRoomType">Room Type</label>
        <select id="hotelRoomType" class="form-control">
          <option>Single</option>
          <option selected>Double</option>
          <option>Suite</option>
        </select>
      </div>
      <div class="form-group">
        <label for="hotelGuests">Guests</label>
        <input type="number" id="hotelGuests" class="form-control" value="2" min="1" required>
      </div>
    </div>
  </div>
`);

    });
  }

  if (flightId) {
    $.get(`http://localhost:5002/api/flights/${flightId}`, function (flight) {
        flightBlock.html(`
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Selected Flight</h5>
          <p>${flight.airline} - ${flight.flightNumber}</p>
          <p>Departure: ${new Date(flight.departureTime).toLocaleString()}</p>
          <p>Arrival: ${new Date(flight.arrivalTime).toLocaleString()}</p>
          <p>Price: $${flight.price.toFixed(2)}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h5 class="mb-3">Flight Booking Info</h5>
      <div class="form-group">
        <label for="flightClass">Travel Class</label>
        <select id="flightClass" class="form-control">
          <option>Economy</option>
          <option>Business</option>
          <option>First Class</option>
        </select>
      </div>
      <div class="form-group">
        <label for="flightPassengers">Passengers</label>
        <input type="number" id="flightPassengers" class="form-control" value="1" min="1" required>
      </div>
    </div>
  </div>
`);

    });
  }

  if (activityIds && activityIds.length > 0) {
    activityIds.forEach(id => {
      $.get(`http://localhost:5002/api/activities/${id}`, function (activity) {
        const uniqueId = `activity_${activity.id}`;
activityBlock.append(`
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <img src="${activity.imageUrl}" class="card-img-top" alt="${activity.name}" style="height: 200px; object-fit: cover;">
        <div class="card-body">
          <h5 class="card-title">Selected Activity</h5>
          <p>${activity.name}</p>
          <p>${activity.description}</p>
          <p>Price: $${activity.price.toFixed(2)}</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h5 class="mb-3">Activity Booking Info</h5>
      <div class="form-group">
        <label for="${uniqueId}_date">Activity Date</label>
        <input type="date" id="${uniqueId}_date" class="form-control activity-date" data-id="${activity.id}" required>
      </div>
      <div class="form-group">
        <label for="${uniqueId}_guests">Number of Guests</label>
        <input type="number" id="${uniqueId}_guests" class="form-control activity-guests" data-id="${activity.id}" value="1" min="1" required>
      </div>
    </div>
  </div>
`);

      });
    });
  }

  $('#finalBookingForm').submit(function (e) {
    e.preventDefault();

    const activityBookingDetails = [];

    $('.activity-guests').each(function () {
    const activityId = $(this).data('id');
    const guests = parseInt($(this).val()) || 1;
    const date = $(`#activity_${activityId}_date`).val();

    if (date) {
        activityBookingDetails.push({
        activityId: parseInt(activityId),
        guests: guests,
        activityDate: date
        });
    }
    });

    const requestData = {
        userEmail: $('#email').val(),
        bookingDate: new Date().toISOString(),
        hotelBooking: hotelId ? {
            hotelId: parseInt(hotelId),
            checkIn: $('#hotelCheckIn').val(),
            checkOut: $('#hotelCheckOut').val(),
            roomType: $('#hotelRoomType').val(),
            guests: parseInt($('#hotelGuests').val())
        } : null,
        flightBooking: flightId ? {
            flightId: parseInt(flightId),
            travelClass: $('#flightClass').val(),
            passengers: parseInt($('#flightPassengers').val())
        } : null,
        activityBookings: activityBookingDetails
        };
        console.log(requestData);

    $.ajax({
      url: 'http://localhost:5002/api/booking',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(requestData),
      success: function () {
        localStorage.removeItem("bookingSelections");
        window.location.href = "confirmation.html";
      },
      error: function () {
        alert("There was an error confirming your booking.");
      }
    });
  });

  // ✅ THIS PART is what you were missing:
  $('#overlayer').fadeOut();
  $('.loader').fadeOut();
});

    </script>
    
</body>
</html>
